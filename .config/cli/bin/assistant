#!/usr/bin/env bash
# assistant – command dispatcher

set -euo pipefail

ASSISTANT_DIR="$HOME/.config/shell/bin/assistant-commands/"

usage() {
  cat <<EOF
assistant – project context helper

Usage:
  assistant <command> [args...]

Available commands:
  bootstrap        Ensure environment and project setup
  build-commands   Build or update .project/commands.log
  capture-history  Append shell history to raw history log
  doctor           Diagnose assistant setup
  help             Show this help

Examples:
  assistant bootstrap
  assistant build-commands
EOF
}

# No command → help
if [[ $# -eq 0 ]]; then
  usage
  exit 0
fi

COMMAND="$1"
shift

# Built-in help
if [[ "$COMMAND" == "help" || "$COMMAND" == "--help" || "$COMMAND" == "-h" ]]; then
  usage
  exit 0
fi

if [[ ! -d "$ASSISTANT_DIR" ]]; then
  echo "assistant error: assistant directory not found: $ASSISTANT_DIR" >&2
  exit 1
fi

SCRIPT="$ASSISTANT_DIR/$COMMAND.sh"

if [[ ! -f "$SCRIPT" ]]; then
  echo "assistant error: unknown command '$COMMAND'" >&2
  echo "" >&2
  usage >&2
  exit 1
fi

exec "$SCRIPT" "$@"
